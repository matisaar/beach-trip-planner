<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amalfi Coast Airbnbs ‚Äî Value Optimizer</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
  :root {
    --ocean: #0077b6; --ocean-dark: #023e8a; --ocean-light: #00b4d8;
    --sunset: #ff6b35; --coral: #e63946;
    --palm: #2d6a4f; --dark: #1a1a2e; --gray: #6b7280;
    --gold: #f59e0b;
    --bg: #faf8f5; --border: #e8e4df; --card: #ffffff;
    --muted: #7a7a7a; --accent: #d4763c;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: var(--dark); line-height: 1.6; }
  
  /* ‚îÄ‚îÄ Hero ‚îÄ‚îÄ */
  .hero {
    background: linear-gradient(135deg, #1a472a 0%, #023e8a 50%, var(--ocean) 100%);
    color: white; padding: 36px 24px 28px; text-align: center;
  }
  .hero h1 { font-size: clamp(1.3rem, 3vw, 1.7rem); font-weight: 900; margin-bottom: 5px; }
  .hero p { font-size: 0.85rem; opacity: 0.75; margin-bottom: 12px; }
  .hero-nav { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
  .hero-nav a {
    color: rgba(255,255,255,0.8); text-decoration: none; font-size: 0.78rem;
    padding: 5px 14px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.25);
    transition: all 0.2s;
  }
  .hero-nav a:hover { background: rgba(255,255,255,0.15); color: white; }

  /* ‚îÄ‚îÄ Stats bar ‚îÄ‚îÄ */
  .stats-bar {
    display: flex; justify-content: center; gap: 24px; flex-wrap: wrap;
    padding: 12px 20px; background: var(--card); border-bottom: 1px solid var(--border);
  }
  .sb-item { text-align: center; }
  .sb-val { font-weight: 800; color: var(--ocean-dark); font-size: 1rem; }
  .sb-label { color: var(--muted); font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.5px; }

  /* ‚îÄ‚îÄ Controls ‚îÄ‚îÄ */
  .controls {
    display: flex; align-items: center; gap: 12px; padding: 14px 24px;
    border-bottom: 1px solid var(--border); background: var(--card); flex-wrap: wrap;
  }
  .ctrl-label { font-size: 0.75rem; font-weight: 700; color: var(--dark); }
  .ctrl-group { display: flex; gap: 4px; }
  .ctrl-btn {
    padding: 5px 12px; font-size: 0.72rem; font-weight: 600;
    border: 1px solid var(--border); background: var(--bg); color: var(--muted);
    border-radius: 7px; cursor: pointer; transition: all 0.15s; font-family: inherit;
  }
  .ctrl-btn:hover { border-color: var(--ocean); color: var(--ocean); }
  .ctrl-btn.active { background: var(--ocean); color: white; border-color: var(--ocean); }
  .ctrl-search {
    padding: 6px 12px; background: var(--bg); border: 1px solid var(--border);
    border-radius: 7px; font-size: 0.78rem; font-family: inherit; outline: none;
    width: 180px; color: var(--dark);
  }
  .ctrl-search:focus { border-color: var(--ocean); }
  .ctrl-search::placeholder { color: #bbb; }
  .ctrl-spacer { flex: 1; }
  .ctrl-view { display: flex; gap: 4px; }
  .view-btn {
    width: 32px; height: 32px; border-radius: 7px; border: 1px solid var(--border);
    background: var(--bg); cursor: pointer; display: flex; align-items: center;
    justify-content: center; font-size: 0.85rem; transition: all 0.15s;
  }
  .view-btn:hover { border-color: var(--ocean); }
  .view-btn.active { background: var(--ocean); border-color: var(--ocean); }
  .view-btn.active svg { stroke: white; }
  .view-btn svg { width: 16px; height: 16px; stroke: var(--muted); fill: none; stroke-width: 2; }

  /* ‚îÄ‚îÄ Weight sliders ‚îÄ‚îÄ */
  .weights {
    display: flex; align-items: center; gap: 16px; padding: 10px 24px;
    border-bottom: 1px solid var(--border); background: #fdfcfa; flex-wrap: wrap;
  }
  .w-title { font-size: 0.72rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }
  .w-group { display: flex; align-items: center; gap: 6px; }
  .w-label { font-size: 0.72rem; color: var(--muted); }
  .w-slider {
    width: 80px; -webkit-appearance: none; height: 3px; border-radius: 2px;
    background: var(--border); outline: none;
  }
  .w-slider::-webkit-slider-thumb {
    -webkit-appearance: none; width: 14px; height: 14px; border-radius: 50%;
    background: var(--ocean); cursor: pointer; border: 2px solid white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }
  .w-val { font-size: 0.72rem; font-weight: 700; color: var(--ocean-dark); width: 20px; }

  /* ‚îÄ‚îÄ Card Grid View ‚îÄ‚îÄ */
  .grid-view {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px; padding: 20px 24px;
    max-width: 1400px; margin: 0 auto;
  }
  .card {
    background: var(--card); border-radius: 14px; overflow: hidden;
    border: 1px solid var(--border); transition: all 0.2s; cursor: pointer;
    position: relative;
  }
  .card:hover { box-shadow: 0 8px 30px rgba(0,0,0,0.1); transform: translateY(-2px); }
  .card-img {
    width: 100%; height: 180px; object-fit: cover; background: #eee;
    display: block;
  }
  .card-rank {
    position: absolute; top: 10px; left: 10px;
    width: 28px; height: 28px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.72rem; font-weight: 800; color: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  .card-rank.top { background: linear-gradient(135deg, #e87d3e, #d4363b); }
  .card-rank.good { background: #e6a756; }
  .card-rank.okay { background: #a0aec0; }
  .card-fav {
    position: absolute; top: 10px; right: 10px;
    background: rgba(0,0,0,0.55); color: white; font-size: 0.68rem;
    padding: 3px 8px; border-radius: 6px; font-weight: 600;
    backdrop-filter: blur(4px);
  }
  .card-body { padding: 14px 16px; }
  .card-name { font-size: 0.88rem; font-weight: 700; margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .card-area { font-size: 0.72rem; color: var(--muted); margin-bottom: 10px; }
  .card-stats { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
  .card-price { font-size: 1rem; font-weight: 800; color: var(--palm); }
  .card-rating { font-size: 0.78rem; color: var(--gold); font-weight: 600; }
  .card-reviews { font-size: 0.72rem; color: var(--muted); }
  .card-score-wrap { display: flex; align-items: center; gap: 8px; }
  .card-bar-bg {
    flex: 1; height: 6px; border-radius: 3px; background: var(--border); overflow: hidden;
  }
  .card-bar-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }
  .card-bar-fill.top { background: linear-gradient(90deg, #e87d3e, #d4363b); }
  .card-bar-fill.good { background: #e6a756; }
  .card-bar-fill.okay { background: #b8c9d6; }
  .card-score-num {
    font-size: 0.75rem; font-weight: 800; color: var(--ocean-dark);
    min-width: 28px; text-align: right;
  }
  .card-score-label { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.3px; }

  /* ‚îÄ‚îÄ Bubble Chart View ‚îÄ‚îÄ */
  .chart-view { padding: 20px 24px; max-width: 1400px; margin: 0 auto; display: none; }
  .chart-container {
    position: relative; background: var(--card); border-radius: 14px;
    border: 1px solid var(--border); padding: 16px; overflow: hidden;
  }
  .chart-canvas { width: 100%; height: 520px; display: block; }
  .chart-axes {
    position: absolute; bottom: 28px; left: 50%; transform: translateX(-50%);
    font-size: 0.72rem; font-weight: 600; color: var(--muted);
  }
  .chart-y-label {
    position: absolute; left: 12px; top: 50%; transform: translateY(-50%) rotate(-90deg);
    font-size: 0.72rem; font-weight: 600; color: var(--muted);
  }
  .chart-legend {
    display: flex; gap: 16px; justify-content: center; margin-top: 12px;
    font-size: 0.72rem; color: var(--muted);
  }
  .legend-dot {
    display: inline-block; width: 12px; height: 12px; border-radius: 50%;
    vertical-align: middle; margin-right: 4px;
  }

  /* ‚îÄ‚îÄ Tooltip ‚îÄ‚îÄ */
  .tooltip {
    position: fixed; display: none; z-index: 500;
    background: var(--card); border: 1px solid var(--border);
    border-radius: 14px; overflow: hidden; width: 280px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    pointer-events: none;
  }
  .tooltip.visible { display: block; animation: fadeIn 0.15s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: scale(0.96); } to { opacity: 1; transform: scale(1); } }
  .tt-img { width: 100%; height: 150px; object-fit: cover; background: #eee; display: block; }
  .tt-body { padding: 12px 14px; }
  .tt-name { font-size: 0.85rem; font-weight: 700; margin-bottom: 2px; }
  .tt-area { font-size: 0.7rem; color: var(--muted); margin-bottom: 8px; }
  .tt-row { display: flex; justify-content: space-between; align-items: center; }
  .tt-price { font-size: 0.95rem; font-weight: 800; color: var(--palm); }
  .tt-rating { font-size: 0.78rem; color: var(--gold); font-weight: 600; }
  .tt-reviews { font-size: 0.72rem; color: var(--muted); }
  .tt-score { margin-top: 8px; display: flex; align-items: center; gap: 6px; }
  .tt-score-bar { flex: 1; height: 5px; border-radius: 3px; background: var(--border); overflow: hidden; }
  .tt-score-fill { height: 100%; border-radius: 3px; }
  .tt-score-num { font-size: 0.72rem; font-weight: 800; color: var(--ocean-dark); }

  /* ‚îÄ‚îÄ Detail Modal ‚îÄ‚îÄ */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 900;
    display: none; align-items: center; justify-content: center;
    backdrop-filter: blur(4px);
  }
  .modal-overlay.visible { display: flex; animation: fadeIn 0.2s ease; }
  .modal {
    background: var(--card); border-radius: 18px; width: 90%; max-width: 480px;
    max-height: 90vh; overflow-y: auto; position: relative;
    box-shadow: 0 20px 60px rgba(0,0,0,0.25);
  }
  .modal-close {
    position: absolute; top: 12px; right: 14px; z-index: 10;
    background: rgba(0,0,0,0.5); border: none; color: white;
    width: 32px; height: 32px; border-radius: 50%; font-size: 18px;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    backdrop-filter: blur(4px); transition: background 0.2s;
  }
  .modal-close:hover { background: rgba(0,0,0,0.7); }
  .modal-img { width: 100%; height: 240px; object-fit: cover; display: block; background: #eee; }
  .modal-body { padding: 20px 24px; }
  .modal-name { font-size: 1.1rem; font-weight: 800; margin-bottom: 3px; }
  .modal-area { font-size: 0.8rem; color: var(--muted); margin-bottom: 16px; }
  .modal-score-wrap {
    background: linear-gradient(135deg, #fff8f0, #fff5eb);
    border: 1px solid #fed7aa; border-radius: 12px; padding: 14px 16px; margin-bottom: 16px;
  }
  .modal-score-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
  .modal-score-title { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: #92400e; }
  .modal-score-val { font-size: 1.5rem; font-weight: 900; color: var(--ocean-dark); }
  .modal-score-bar { height: 8px; border-radius: 4px; background: #f5e6d3; overflow: hidden; }
  .modal-score-fill { height: 100%; border-radius: 4px; background: linear-gradient(90deg, #e6a756, #e87d3e, #d4363b); }
  .modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px; }
  .modal-stat { background: var(--bg); border-radius: 10px; padding: 14px; text-align: center; }
  .modal-stat .val { font-size: 1.25rem; font-weight: 800; color: var(--ocean-dark); }
  .modal-stat .val.price { color: var(--palm); }
  .modal-stat .lbl { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }
  .modal-badges { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 16px; }
  .modal-badge { font-size: 0.7rem; font-weight: 600; padding: 4px 10px; border-radius: 6px; }
  .modal-badge.fire { background: #ffedd5; color: #9a3412; }
  .modal-badge.good { background: #fef3c7; color: #92400e; }
  .modal-badge.gold { background: #fef3c7; color: #92400e; }
  .modal-badge.green { background: #dcfce7; color: var(--palm); }
  .modal-book {
    display: block; width: 100%; padding: 14px; text-align: center;
    background: linear-gradient(135deg, #FF385C, #e31c5f); color: white;
    text-decoration: none; border-radius: 12px; font-size: 0.9rem;
    font-weight: 700; font-family: inherit; transition: all 0.2s;
  }
  .modal-book:hover { filter: brightness(1.1); transform: translateY(-1px); }

  .no-results {
    text-align: center; padding: 60px 20px; color: var(--muted);
    font-size: 0.9rem;
  }

  @media (max-width: 700px) {
    .grid-view { grid-template-columns: 1fr; padding: 12px; gap: 12px; }
    .controls { padding: 10px 12px; gap: 8px; }
    .weights { padding: 8px 12px; gap: 10px; }
    .ctrl-search { width: 140px; }
  }
</style>
</head>
<body>

<div class="hero">
  <h1>üéØ Value Optimizer</h1>
  <p>50 best-value Amalfi Coast stays, scored by price + rating + reviews</p>
  <div class="hero-nav">
    <a href="best-trip.html">‚Üê Itinerary</a>
    <a href="airbnbs.html">All 280 Listings</a>
  </div>
</div>

<div class="stats-bar">
  <div class="sb-item"><div class="sb-val">50</div><div class="sb-label">Analyzed</div></div>
  <div class="sb-item"><div class="sb-val">$328/n</div><div class="sb-label">Avg Price</div></div>
  <div class="sb-item"><div class="sb-val">4.91</div><div class="sb-label">Avg Rating</div></div>
  <div class="sb-item"><div class="sb-val">$42/n</div><div class="sb-label">Cheapest</div></div>
  <div class="sb-item"><div class="sb-val">#1</div><div class="sb-label">Full relaxation</div></div>
</div>

<div class="controls">
  <span class="ctrl-label">Sort</span>
  <div class="ctrl-group">
    <button class="ctrl-btn active" data-sort="score">üéØ Score</button>
    <button class="ctrl-btn" data-sort="price">üí∞ Price</button>
    <button class="ctrl-btn" data-sort="rating">‚≠ê Rating</button>
    <button class="ctrl-btn" data-sort="reviews">üí¨ Reviews</button>
  </div>
  <input type="text" class="ctrl-search" placeholder="Search..." id="searchInput">
  <div class="ctrl-spacer"></div>
  <div class="ctrl-view">
    <button class="view-btn active" data-view="grid" title="Card grid">
      <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
    </button>
    <button class="view-btn" data-view="chart" title="Bubble chart">
      <svg viewBox="0 0 24 24"><circle cx="8" cy="16" r="3"/><circle cx="16" cy="8" r="4"/><circle cx="14" cy="17" r="2"/></svg>
    </button>
  </div>
</div>

<div class="weights">
  <span class="w-title">‚öñÔ∏è Weights</span>
  <div class="w-group">
    <span class="w-label">Rating</span>
    <input type="range" class="w-slider" id="wR" min="0" max="100" value="40">
    <span class="w-val" id="wRV">40</span>
  </div>
  <div class="w-group">
    <span class="w-label">Reviews</span>
    <input type="range" class="w-slider" id="wRv" min="0" max="100" value="30">
    <span class="w-val" id="wRvV">30</span>
  </div>
  <div class="w-group">
    <span class="w-label">Price ‚Üì</span>
    <input type="range" class="w-slider" id="wP" min="0" max="100" value="30">
    <span class="w-val" id="wPV">30</span>
  </div>
</div>

<div class="grid-view" id="gridView"></div>

<div class="chart-view" id="chartView">
  <div class="chart-container">
    <canvas class="chart-canvas" id="bubbleCanvas"></canvas>
    <span class="chart-axes">Price per Night (CAD $) ‚Üí</span>
    <span class="chart-y-label">Guest Rating ‚òÖ</span>
  </div>
  <div class="chart-legend">
    <span><span class="legend-dot" style="background:linear-gradient(135deg,#e87d3e,#d4363b)"></span> Top Value</span>
    <span><span class="legend-dot" style="background:#e6a756"></span> Good Value</span>
    <span><span class="legend-dot" style="background:#b8c9d6"></span> Decent</span>
    <span>Bigger bubble = higher score</span>
  </div>
</div>

<div class="tooltip" id="tooltip">
  <img class="tt-img" id="ttImg" src="" alt="">
  <div class="tt-body">
    <div class="tt-name" id="ttName"></div>
    <div class="tt-area" id="ttArea"></div>
    <div class="tt-row">
      <span class="tt-price" id="ttPrice"></span>
      <span class="tt-rating" id="ttRating"></span>
      <span class="tt-reviews" id="ttReviews"></span>
    </div>
    <div class="tt-score">
      <div class="tt-score-bar"><div class="tt-score-fill" id="ttScoreFill"></div></div>
      <span class="tt-score-num" id="ttScoreNum"></span>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">&times;</button>
    <img class="modal-img" id="mImg" src="" alt="">
    <div class="modal-body">
      <div class="modal-name" id="mName"></div>
      <div class="modal-area" id="mArea"></div>
      <div class="modal-score-wrap">
        <div class="modal-score-header">
          <span class="modal-score-title">Value Score</span>
          <span class="modal-score-val" id="mScoreVal"></span>
        </div>
        <div class="modal-score-bar"><div class="modal-score-fill" id="mScoreFill"></div></div>
      </div>
      <div class="modal-grid">
        <div class="modal-stat"><div class="val price" id="mPrice"></div><div class="lbl">Per Night</div></div>
        <div class="modal-stat"><div class="val" id="mTotal"></div><div class="lbl">7 Nights</div></div>
        <div class="modal-stat"><div class="val" id="mRating"></div><div class="lbl">Rating</div></div>
        <div class="modal-stat"><div class="val" id="mReviews"></div><div class="lbl">Reviews</div></div>
      </div>
      <div class="modal-badges" id="mBadges"></div>
      <a class="modal-book" id="mLink" href="#" target="_blank">View on Airbnb ‚Üí</a>
    </div>
  </div>
</div>

<script>
const DATA = [{"id": "6690135", "name": "Full relaxation", "area": "Agerola", "price": 185.0, "total": 1295.0, "rating": 4.8, "reviews": 619, "url": "https://www.airbnb.ca/rooms/6690135?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/miso/Hosting-6690135/original/0c06ad47-6c8b-4d7a-89f2-ef0f16c3912a.jpeg", "guest_fav": false, "score": 100, "rank": 1}, {"id": "2938612", "name": "unbelievable new house sea view", "area": "Ravello", "price": 224.0, "total": 1570.0, "rating": 4.81, "reviews": 745, "url": "https://www.airbnb.ca/rooms/2938612?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/84896876/0b1113f1_original.jpg", "guest_fav": true, "score": 98, "rank": 2}, {"id": "32588731", "name": "Windows on heaven. Total sea view house!", "area": "Scala", "price": 224.0, "total": 1568.0, "rating": 4.98, "reviews": 445, "url": "https://www.airbnb.ca/rooms/32588731?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/hosting/Hosting-U3RheVN1cHBseUxpc3Rpbmc6MzI1ODg3MzE%3D/original/38e2203b-a04c-469c-a47e-ce4dc45dc593.jpeg", "guest_fav": false, "score": 91, "rank": 3}, {"id": "21660322", "name": "Casa San Nicola, Positano", "area": "Positano", "price": 551.0, "total": 3854.0, "rating": 4.82, "reviews": 509, "url": "https://www.airbnb.ca/rooms/21660322?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/hosting/Hosting-21660322/original/f2d9a951-35bf-44bc-9d2e-3f1ed209d66b.jpeg", "guest_fav": true, "score": 77, "rank": 4}, {"id": "19917103", "name": "Casa Vacanze Mir\u00f2 (Airbnb), Ravello", "area": "Ravello", "price": 320.0, "total": 2240.0, "rating": 5.0, "reviews": 417, "url": "https://www.airbnb.ca/rooms/19917103?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/9ae3c2b8-21a5-4f18-bbeb-b6dfa43bd05f.jpg", "guest_fav": false, "score": 77, "rank": 5}, {"id": "35930217", "name": "LUCY\u2019S HOUSE - comfortable apartment in Amalfi", "area": "Pontone", "price": 348.0, "total": 2433.0, "rating": 4.92, "reviews": 438, "url": "https://www.airbnb.ca/rooms/35930217?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/36e419cf-a1f1-4ca9-a4c8-a494517488ce.jpg", "guest_fav": true, "score": 77, "rank": 6}, {"id": "3069031", "name": "Ocean view Martida_apartment studio", "area": "Praiano", "price": 296.0, "total": 2069.0, "rating": 4.92, "reviews": 390, "url": "https://www.airbnb.ca/rooms/3069031?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/70476242/063d3c43_original.jpg", "guest_fav": false, "score": 65, "rank": 7}, {"id": "18457653", "name": "The home of the Gods (24/7 support) entire house", "area": "Praiano", "price": 607.0, "total": 4246.0, "rating": 4.99, "reviews": 429, "url": "https://www.airbnb.ca/rooms/18457653?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/ff01aa2d-36bc-4a61-b04b-85bd29200f1d.jpg", "guest_fav": false, "score": 62, "rank": 8}, {"id": "18939770", "name": "Beata Solitudo Hostel - Mixed Room", "area": "Conca dei Marini", "price": 291.0, "total": 2037.0, "rating": 4.88, "reviews": 385, "url": "https://www.airbnb.ca/rooms/18939770?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "", "guest_fav": true, "score": 61, "rank": 9}, {"id": "17735253", "name": "Beata Solitudo Hostel - Female Dorm", "area": "Conca dei Marini", "price": 42.0, "total": 291.0, "rating": 4.83, "reviews": 332, "url": "https://www.airbnb.ca/rooms/17735253?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "", "guest_fav": true, "score": 56, "rank": 10}, {"id": "19538495", "name": "Home holiday \"Marygi\u00f2\"", "area": "Agerola", "price": 149.0, "total": 1041.0, "rating": 4.97, "reviews": 322, "url": "https://www.airbnb.ca/rooms/19538495?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/e7970991-75c1-4062-b2a9-dfe0c38bb9bb.jpg", "guest_fav": false, "score": 55, "rank": 11}, {"id": "18071473", "name": "Alma House", "area": "Amalfi", "price": 270.0, "total": 1887.0, "rating": 4.8, "reviews": 374, "url": "https://www.airbnb.ca/rooms/18071473?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/3178b78a-3887-4ec4-a383-e5b5b3e8857c.jpg", "guest_fav": true, "score": 53, "rank": 12}, {"id": "43281874", "name": "Home overlooking Vesuvius on the hills of Castellammare", "area": "Other", "price": 177.0, "total": 1236.0, "rating": 4.97, "reviews": 319, "url": "https://www.airbnb.ca/rooms/43281874?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/dc28e98e-66ca-4db1-880b-481584d48828.jpg", "guest_fav": false, "score": 53, "rank": 13}, {"id": "617194", "name": "Albachiara-hiking Amalficoast-PathOfGods-Jasmine", "area": "Furore", "price": 122.0, "total": 852.0, "rating": 4.9, "reviews": 321, "url": "https://www.airbnb.ca/rooms/617194?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/14279174/826af118_original.jpg", "guest_fav": true, "score": 52, "rank": 14}, {"id": "13671263", "name": "EXCLUSIVE APARTAMENT your piece of paradise", "area": "Furore", "price": 455.0, "total": 3183.0, "rating": 4.98, "reviews": 370, "url": "https://www.airbnb.ca/rooms/13671263?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/83d4e63c-140e-4b51-95bb-45147fa8ec2c.jpg", "guest_fav": false, "score": 52, "rank": 15}, {"id": "19488613", "name": "Amalfi Casa Mikr\u00f2", "area": "Amalfi", "price": 266.0, "total": 1862.0, "rating": 4.9, "reviews": 335, "url": "https://www.airbnb.ca/rooms/19488613?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/d6910670-70ea-4f1d-9a2f-774b15fb31bb.jpg", "guest_fav": true, "score": 47, "rank": 16}, {"id": "44836624", "name": "PARADISE APARTMENT", "area": "Agerola", "price": 144.0, "total": 1007.0, "rating": 4.95, "reviews": 300, "url": "https://www.airbnb.ca/rooms/44836624?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/a497debf-0fc7-4ac2-8c79-a0efdb4ab1ec.jpg", "guest_fav": false, "score": 47, "rank": 17}, {"id": "12964626", "name": "AQUAMARINE BLUE, AMALFI COAST", "area": "Furore", "price": 210.0, "total": 1467.0, "rating": 4.89, "reviews": 324, "url": "https://www.airbnb.ca/rooms/12964626?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/2b61b8e6-ee2f-4963-806b-86ae324b0d50.jpg", "guest_fav": true, "score": 47, "rank": 18}, {"id": "47576133", "name": "Room with en-suite bathroom. Station super close!", "area": "Other", "price": 107.0, "total": 749.0, "rating": 4.94, "reviews": 281, "url": "https://www.airbnb.ca/rooms/47576133?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/e144da7b-75d0-4b42-9f91-e39804d4009f.jpg", "guest_fav": false, "score": 43, "rank": 19}, {"id": "14728105", "name": "Serenity", "area": "Positano", "price": 546.0, "total": 3820.0, "rating": 4.95, "reviews": 363, "url": "https://www.airbnb.ca/rooms/14728105?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/airflow/Hosting-14728105/original/4acc9c33-be7f-4884-bf8b-c521cb6c4030.jpg", "guest_fav": false, "score": 42, "rank": 20}, {"id": "14330246", "name": "Bomerano Apartments 50 meters from the Path of the Gods", "area": "Agerola", "price": 164.0, "total": 1147.0, "rating": 4.87, "reviews": 302, "url": "https://www.airbnb.ca/rooms/14330246?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/39cb85ab-d83c-4c1f-ae8f-ec47d7518adf.jpg", "guest_fav": true, "score": 41, "rank": 21}, {"id": "19633284", "name": "Amalfi Lady Laura House", "area": "Amalfi", "price": 607.0, "total": 4247.0, "rating": 4.99, "reviews": 366, "url": "https://www.airbnb.ca/rooms/19633284?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/6a4be995-f696-4c7a-b67b-4987d166cdba.jpg", "guest_fav": false, "score": 41, "rank": 22}, {"id": "2580261", "name": "Lovely Loft Positano with breakfast", "area": "Positano", "price": 449.0, "total": 3146.0, "rating": 4.8, "reviews": 362, "url": "https://www.airbnb.ca/rooms/2580261?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/777a3fbb-58fd-4b4a-a2e7-a36953abf876.jpg", "guest_fav": false, "score": 38, "rank": 23}, {"id": "12802359", "name": "B&B la Palombara", "area": "Other", "price": 436.0, "total": 3055.0, "rating": 4.98, "reviews": 309, "url": "https://www.airbnb.ca/rooms/12802359?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/c9b6e849-41fe-4c4b-b86d-39b361886e06.jpg", "guest_fav": false, "score": 33, "rank": 24}, {"id": "48335949", "name": "Private room, Salerno Centre/Station", "area": "Other", "price": 99.0, "total": 693.0, "rating": 4.94, "reviews": 245, "url": "https://www.airbnb.ca/rooms/48335949?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "", "guest_fav": true, "score": 32, "rank": 25}, {"id": "13277761", "name": "From Zio Nicola Piano di Sorrento House for Holiday", "area": "Other", "price": 357.0, "total": 2498.0, "rating": 4.94, "reviews": 289, "url": "https://www.airbnb.ca/rooms/13277761?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/8b9fbac0-a897-4777-ac41-af16b5ca5f71.jpg", "guest_fav": false, "score": 29, "rank": 26}, {"id": "191220", "name": "Agerola Private \u2013 Easy Check-in & Bus 2 Min Walk", "area": "Conca dei Marini", "price": 161.0, "total": 1130.0, "rating": 4.91, "reviews": 244, "url": "https://www.airbnb.ca/rooms/191220?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/hosting/Hosting-U3RheVN1cHBseUxpc3Rpbmc6MTkxMjIw/original/d037bf49-b109-4a63-ba3b-e96a973f60f9.png", "guest_fav": true, "score": 25, "rank": 27}, {"id": "9900192", "name": "Il Pertuso B&B, Teresa Room", "area": "Nocelle", "price": 282.0, "total": 1977.0, "rating": 4.92, "reviews": 259, "url": "https://www.airbnb.ca/rooms/9900192?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/6471c3d0-c08a-4dc3-8d15-e39606bcb843.jpg", "guest_fav": false, "score": 23, "rank": 28}, {"id": "12866730", "name": "The Palombara Capri room", "area": "Other", "price": 363.0, "total": 2540.0, "rating": 4.98, "reviews": 259, "url": "https://www.airbnb.ca/rooms/12866730?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/49d2c71d-092b-4761-9bff-e285a4058ce9.jpg", "guest_fav": false, "score": 21, "rank": 29}, {"id": "41642520", "name": "My Habitat - Your home away from home", "area": "Other", "price": 150.0, "total": 1050.0, "rating": 4.96, "reviews": 217, "url": "https://www.airbnb.ca/rooms/41642520?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/0bb33890-fb36-4b7e-8486-c849e10b0daa.jpg", "guest_fav": true, "score": 20, "rank": 30}, {"id": "13161568", "name": "Terry\u2019s Home", "area": "Other", "price": 366.0, "total": 2564.0, "rating": 4.89, "reviews": 266, "url": "https://www.airbnb.ca/rooms/13161568?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/bef06df4-92cd-4446-aa18-71719537d280.jpg", "guest_fav": true, "score": 18, "rank": 31}, {"id": "25073339", "name": "CRIS HOUSE - Mena", "area": "Atrani", "price": 307.0, "total": 2152.0, "rating": 4.82, "reviews": 261, "url": "https://www.airbnb.ca/rooms/25073339?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/aa136088-6d0d-4100-b3a5-a8894795eb7c.jpg", "guest_fav": true, "score": 15, "rank": 32}, {"id": "20491538", "name": "La Maison du Paradis B&B nel cuore di Salerno", "area": "Vietri sul Mare", "price": 270.0, "total": 1889.0, "rating": 4.96, "reviews": 223, "url": "https://www.airbnb.ca/rooms/20491538?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/227ea05a-4d43-4d5b-b8af-635e8deac0fb.jpg", "guest_fav": false, "score": 14, "rank": 33}, {"id": "1244910", "name": "2/4 people Cozy&Central Room in 1900's building", "area": "Other", "price": 183.0, "total": 1283.0, "rating": 4.87, "reviews": 223, "url": "https://www.airbnb.ca/rooms/1244910?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/61ad72b1-6648-4133-b941-d1b6fd7e26e1.jpg", "guest_fav": true, "score": 14, "rank": 34}, {"id": "5996171", "name": "IlPertusoB&B, Camera Luisa", "area": "Nocelle", "price": 282.0, "total": 1977.0, "rating": 4.93, "reviews": 228, "url": "https://www.airbnb.ca/rooms/5996171?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/74672047/4ca39f81_original.jpg", "guest_fav": true, "score": 13, "rank": 35}, {"id": "29621244", "name": "Nocelle, Standard room", "area": "Nocelle", "price": 244.0, "total": 1705.0, "rating": 4.89, "reviews": 222, "url": "https://www.airbnb.ca/rooms/29621244?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/e97dd1af-46c2-4eb4-9c02-cb1ad91b0b0b.jpg", "guest_fav": true, "score": 11, "rank": 36}, {"id": "4498735", "name": "Apartment in Praiano, Amalfi Coast", "area": "Praiano", "price": 367.0, "total": 2570.0, "rating": 4.9, "reviews": 241, "url": "https://www.airbnb.ca/rooms/4498735?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/56485595/2aedc10e_original.jpg", "guest_fav": true, "score": 10, "rank": 37}, {"id": "32690686", "name": "Capo D'acqua 1 Retreat", "area": "Positano", "price": 184.0, "total": 1288.0, "rating": 4.94, "reviews": 196, "url": "https://www.airbnb.ca/rooms/32690686?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/hosting/Hosting-32690686/original/9ac584eb-ddc0-4b2c-86ca-55dab46986bd.jpeg", "guest_fav": false, "score": 10, "rank": 38}, {"id": "47306992", "name": "Cozy Penthouse with panoramic terrace", "area": "Atrani", "price": 276.0, "total": 1930.0, "rating": 4.95, "reviews": 211, "url": "https://www.airbnb.ca/rooms/47306992?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/21a64410-87b6-4533-8f6a-77df1dc9602c.jpg", "guest_fav": true, "score": 10, "rank": 39}, {"id": "22923567", "name": "Casa Positamo", "area": "Positano", "price": 543.0, "total": 3800.0, "rating": 4.95, "reviews": 258, "url": "https://www.airbnb.ca/rooms/22923567?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/c2adc4ee-4e6c-4ab1-acd0-11e47c9594d5.jpg", "guest_fav": true, "score": 7, "rank": 40}, {"id": "32715535", "name": "Capo D'acqua 3 Retreat", "area": "Positano", "price": 184.0, "total": 1288.0, "rating": 4.94, "reviews": 188, "url": "https://www.airbnb.ca/rooms/32715535?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/05308945-703e-4d4f-9e52-5a39acf79934.jpg", "guest_fav": true, "score": 7, "rank": 41}, {"id": "923862125538251337", "name": "Superior Double Room", "area": "Tramonti", "price": 338.0, "total": 2369.0, "rating": 4.91, "reviews": 222, "url": "https://www.airbnb.ca/rooms/923862125538251337?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/miso/Hosting-923862125538251337/original/33eb5ffc-c3c1-4bac-8050-8a7d4a9b2376.jpeg", "guest_fav": false, "score": 6, "rank": 42}, {"id": "3456236", "name": "Apts with an awesome view!", "area": "Atrani", "price": 253.0, "total": 1769.0, "rating": 4.61, "reviews": 265, "url": "https://www.airbnb.ca/rooms/3456236?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/23373cc4-7b9a-47f2-ad4b-9f83a42584e0.jpg", "guest_fav": false, "score": 6, "rank": 43}, {"id": "13922336", "name": "OASI in the center with parking", "area": "Other", "price": 1673.0, "total": 11711.0, "rating": 4.83, "reviews": 510, "url": "https://www.airbnb.ca/rooms/13922336?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/bb6fa94b-bac5-4877-a790-cf25b618b462.jpg", "guest_fav": false, "score": 5, "rank": 44}, {"id": "13712315", "name": "Titina's Home in Amalfi Coast", "area": "Praiano", "price": 523.0, "total": 3662.0, "rating": 4.83, "reviews": 265, "url": "https://www.airbnb.ca/rooms/13712315?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/3ae03be6-c8cb-4e32-8b2a-b45e143ba25c.jpg", "guest_fav": false, "score": 3, "rank": 45}, {"id": "628862022294633899", "name": "Accommodation in Downtown Salerno", "area": "Other", "price": 259.0, "total": 1812.0, "rating": 4.97, "reviews": 183, "url": "https://www.airbnb.ca/rooms/628862022294633899?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/166d07f3-a9b7-45a5-a173-ec70131783e1.jpg", "guest_fav": false, "score": 3, "rank": 46}, {"id": "5925780", "name": "a slice of paradise in Vietri on the Amalfi Coast", "area": "Vietri sul Mare", "price": 304.0, "total": 2129.0, "rating": 4.98, "reviews": 188, "url": "https://www.airbnb.ca/rooms/5925780?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/hosting/Hosting-U3RheVN1cHBseUxpc3Rpbmc6NTkyNTc4MA%3D%3D/original/4e4201fc-f556-4483-81e8-05ec30e497cd.jpeg", "guest_fav": false, "score": 2, "rank": 47}, {"id": "44353120", "name": "Le Tre Rose, Sorrento Peninsula", "area": "Other", "price": 229.0, "total": 1604.0, "rating": 4.88, "reviews": 193, "url": "https://www.airbnb.ca/rooms/44353120?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/f3b38854-8fa3-4fdd-b0c9-893ece928fe3.jpg", "guest_fav": true, "score": 2, "rank": 48}, {"id": "17631918", "name": "Villa Gio PositanoHouse", "area": "Nocelle", "price": 730.0, "total": 5112.0, "rating": 4.99, "reviews": 270, "url": "https://www.airbnb.ca/rooms/17631918?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/miso/Hosting-17631918/original/5f89a7a6-6280-4624-a77c-8312f8f0e194.jpeg", "guest_fav": false, "score": 2, "rank": 49}, {"id": "35607567", "name": "GStar Flat", "area": "Other", "price": 287.0, "total": 2008.0, "rating": 4.98, "reviews": 178, "url": "https://www.airbnb.ca/rooms/35607567?check_in=2026-08-22&check_out=2026-08-29&adults=2", "img": "https://a0.muscache.com/im/pictures/2be7b1fa-ce3c-4c6e-ad0d-9881a00c0ca3.jpg", "guest_fav": false, "score": 0, "rank": 50}];

/* ‚îÄ‚îÄ Normalize helpers ‚îÄ‚îÄ */
const prices  = DATA.map(d => d.price);
const ratings = DATA.map(d => d.rating);
const revs    = DATA.map(d => d.reviews);
const pMin = Math.min(...prices), pMax = Math.max(...prices);
const rMin = Math.min(...ratings), rMax = Math.max(...ratings);
const rvMax = Math.max(...revs);

/* ‚îÄ‚îÄ Weight sliders ‚îÄ‚îÄ */
const sl = { r: document.getElementById('wR'), rv: document.getElementById('wRv'), p: document.getElementById('wP') };
const slV = { r: document.getElementById('wRV'), rv: document.getElementById('wRvV'), p: document.getElementById('wPV') };

function recalc() {
  const wR = +sl.r.value, wRv = +sl.rv.value, wP = +sl.p.value;
  const wSum = wR + wRv + wP || 1;
  slV.r.textContent = wR; slV.rv.textContent = wRv; slV.p.textContent = wP;
  DATA.forEach(d => {
    const nR  = rMax > rMin ? (d.rating - rMin) / (rMax - rMin) : 0.5;
    const nRv = rvMax > 0 ? Math.min(d.reviews, 500) / 500 : 0.5;
    const nP  = pMax > pMin ? 1 - (d.price - pMin) / (pMax - pMin) : 0.5;
    d._score = ((nR * wR + nRv * wRv + nP * wP) / wSum) * 100;
  });
}
Object.values(sl).forEach(s => s.addEventListener('input', () => { recalc(); render(); }));
recalc();

/* ‚îÄ‚îÄ State ‚îÄ‚îÄ */
let sortBy = 'score', search = '', view = 'grid';

function filtered() {
  let f = DATA.slice();
  if (search) {
    const q = search.toLowerCase();
    f = f.filter(d => d.name.toLowerCase().includes(q) || d.area.toLowerCase().includes(q));
  }
  switch (sortBy) {
    case 'score':   f.sort((a,b) => b._score - a._score); break;
    case 'price':   f.sort((a,b) => a.price - b.price); break;
    case 'rating':  f.sort((a,b) => b.rating - a.rating); break;
    case 'reviews': f.sort((a,b) => b.reviews - a.reviews); break;
  }
  return f;
}

function tier(score) { return score >= 70 ? 'top' : score >= 35 ? 'good' : 'okay'; }
function tierColor(score) {
  if (score >= 70) return '#d4363b';
  if (score >= 35) return '#e6a756';
  return '#b8c9d6';
}
const PLACEHOLDER = 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="240" fill="%23e8e4df"><rect width="400" height="240"/><text x="200" y="125" text-anchor="middle" fill="%23bbb" font-family="Inter,sans-serif" font-size="14">No photo</text></svg>');

/* ‚îÄ‚îÄ Grid view ‚îÄ‚îÄ */
function renderGrid() {
  const f = filtered();
  const el = document.getElementById('gridView');
  if (!f.length) { el.innerHTML = '<div class="no-results">No listings match your search.</div>'; return; }
  el.innerHTML = f.map((d, i) => {
    const s = d._score;
    const t = tier(s);
    const rank = sortBy === 'score' ? i + 1 : d.rank;
    const img = d.img || PLACEHOLDER;
    return `
      <div class="card" onclick="openModal('${d.id}')">
        <img class="card-img" src="${img}" alt="${d.name}" loading="lazy" onerror="this.src='${PLACEHOLDER}'">
        <div class="card-rank ${t}">${rank}</div>
        ${d.guest_fav ? '<div class="card-fav">üèÜ Guest Fav</div>' : ''}
        <div class="card-body">
          <div class="card-name">${d.name}</div>
          <div class="card-area">üìç ${d.area}</div>
          <div class="card-stats">
            <span class="card-price">$${d.price}/n</span>
            <span class="card-rating">‚òÖ ${d.rating.toFixed(2)}</span>
            <span class="card-reviews">${d.reviews} reviews</span>
          </div>
          <div class="card-score-wrap">
            <div class="card-bar-bg"><div class="card-bar-fill ${t}" style="width:${s.toFixed(0)}%"></div></div>
            <span class="card-score-num">${s.toFixed(0)}</span>
            <span class="card-score-label">VALUE</span>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

/* ‚îÄ‚îÄ Bubble chart ‚îÄ‚îÄ */
let bubbles = [];
function renderChart() {
  const canvas = document.getElementById('bubbleCanvas');
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width * dpr;
  canvas.height = 520 * dpr;
  canvas.style.width = rect.width + 'px';
  canvas.style.height = '520px';
  ctx.scale(dpr, dpr);
  const W = rect.width, H = 520;
  const pad = { l: 50, r: 30, t: 20, b: 40 };
  const pw = W - pad.l - pad.r, ph = H - pad.t - pad.b;

  ctx.clearRect(0, 0, W, H);

  // Axes
  ctx.strokeStyle = '#e5e7eb'; ctx.lineWidth = 1;
  // Grid lines
  for (let p = 0; p <= 500; p += 100) {
    const x = pad.l + (p / 500) * pw;
    ctx.beginPath(); ctx.moveTo(x, pad.t); ctx.lineTo(x, H - pad.b); ctx.stroke();
    ctx.fillStyle = '#999'; ctx.font = '10px Inter'; ctx.textAlign = 'center';
    ctx.fillText('$' + p, x, H - pad.b + 14);
  }
  for (let r = 4.75; r <= 5.01; r += 0.05) {
    const y = H - pad.b - ((r - 4.75) / 0.27) * ph;
    ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(W - pad.r, y); ctx.stroke();
    ctx.fillStyle = '#999'; ctx.font = '10px Inter'; ctx.textAlign = 'right';
    ctx.fillText(r.toFixed(2), pad.l - 6, y + 3);
  }

  const f = filtered();
  bubbles = [];

  // Draw bubbles (lowest score first so best are on top)
  const sorted = f.slice().sort((a,b) => a._score - b._score);
  sorted.forEach(d => {
    const x = pad.l + (Math.min(d.price, 500) / 500) * pw;
    const y = H - pad.b - ((d.rating - 4.75) / 0.27) * ph;
    const radius = 6 + (d._score / 100) * 22;
    const color = tierColor(d._score);

    ctx.beginPath();
    ctx.arc(x, y, radius, 0, Math.PI * 2);
    ctx.fillStyle = color + 'cc';
    ctx.fill();
    ctx.strokeStyle = 'rgba(255,255,255,0.8)';
    ctx.lineWidth = 1.5;
    ctx.stroke();

    // Label top 5
    if (d._score >= 85) {
      ctx.fillStyle = '#1a1a2e';
      ctx.font = 'bold 9px Inter';
      ctx.textAlign = 'center';
      let name = d.name.length > 18 ? d.name.substring(0, 16) + '‚Ä¶' : d.name;
      ctx.fillText(name, x, y - radius - 4);
    }

    bubbles.push({ d, x, y, radius });
  });
}

/* ‚îÄ‚îÄ Tooltip for bubble chart ‚îÄ‚îÄ */
const tooltip = document.getElementById('tooltip');
const bubbleCanvas = document.getElementById('bubbleCanvas');

bubbleCanvas.addEventListener('mousemove', e => {
  const rect = bubbleCanvas.getBoundingClientRect();
  const mx = e.clientX - rect.left, my = e.clientY - rect.top;
  let hit = null;
  for (let i = bubbles.length - 1; i >= 0; i--) {
    const b = bubbles[i];
    const dist = Math.sqrt((mx - b.x) ** 2 + (my - b.y) ** 2);
    if (dist <= b.radius) { hit = b; break; }
  }
  if (hit) {
    const d = hit.d;
    document.getElementById('ttImg').src = d.img || PLACEHOLDER;
    document.getElementById('ttName').textContent = d.name;
    document.getElementById('ttArea').textContent = 'üìç ' + d.area;
    document.getElementById('ttPrice').textContent = '$' + d.price + '/n';
    document.getElementById('ttRating').textContent = '‚òÖ ' + d.rating.toFixed(2);
    document.getElementById('ttReviews').textContent = d.reviews + ' reviews';
    document.getElementById('ttScoreFill').style.width = d._score.toFixed(0) + '%';
    document.getElementById('ttScoreFill').style.background = tierColor(d._score);
    document.getElementById('ttScoreNum').textContent = d._score.toFixed(0) + '/100';
    tooltip.classList.add('visible');
    let tx = e.clientX + 16, ty = e.clientY - 100;
    if (tx + 290 > window.innerWidth) tx = e.clientX - 296;
    if (ty < 10) ty = 10;
    tooltip.style.left = tx + 'px';
    tooltip.style.top = ty + 'px';
    bubbleCanvas.style.cursor = 'pointer';
  } else {
    tooltip.classList.remove('visible');
    bubbleCanvas.style.cursor = 'default';
  }
});
bubbleCanvas.addEventListener('mouseleave', () => tooltip.classList.remove('visible'));

bubbleCanvas.addEventListener('click', e => {
  const rect = bubbleCanvas.getBoundingClientRect();
  const mx = e.clientX - rect.left, my = e.clientY - rect.top;
  for (let i = bubbles.length - 1; i >= 0; i--) {
    const b = bubbles[i];
    if (Math.sqrt((mx - b.x) ** 2 + (my - b.y) ** 2) <= b.radius) {
      openModal(b.d.id);
      break;
    }
  }
});

/* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
function openModal(id) {
  const d = DATA.find(d => d.id === id);
  if (!d) return;
  const s = d._score;
  document.getElementById('mImg').src = d.img || PLACEHOLDER;
  document.getElementById('mName').textContent = d.name;
  document.getElementById('mArea').textContent = 'üìç ' + d.area;
  document.getElementById('mScoreVal').textContent = s.toFixed(0) + '/100';
  document.getElementById('mScoreFill').style.width = s.toFixed(0) + '%';
  document.getElementById('mPrice').textContent = '$' + d.price;
  document.getElementById('mTotal').textContent = '$' + d.total;
  document.getElementById('mRating').textContent = '‚òÖ ' + d.rating.toFixed(2);
  document.getElementById('mReviews').textContent = d.reviews;
  document.getElementById('mLink').href = d.url;
  let b = '';
  if (s >= 70) b += '<span class="modal-badge fire">üî• Top Value</span>';
  else if (s >= 35) b += '<span class="modal-badge good">‚úÖ Good Value</span>';
  if (d.guest_fav) b += '<span class="modal-badge gold">üèÜ Guest Favorite</span>';
  if (d.area === 'Agerola') b += '<span class="modal-badge green">üè† Near Home Base</span>';
  document.getElementById('mBadges').innerHTML = b;
  document.getElementById('modalOverlay').classList.add('visible');
  tooltip.classList.remove('visible');
}
function closeModal() { document.getElementById('modalOverlay').classList.remove('visible'); }
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

/* ‚îÄ‚îÄ Render ‚îÄ‚îÄ */
function render() {
  if (view === 'grid') renderGrid();
  else renderChart();
}

/* ‚îÄ‚îÄ Controls ‚îÄ‚îÄ */
document.querySelectorAll('.ctrl-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.ctrl-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    sortBy = btn.dataset.sort;
    render();
  });
});
document.getElementById('searchInput').addEventListener('input', e => { search = e.target.value; render(); });
document.querySelectorAll('.view-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    view = btn.dataset.view;
    document.getElementById('gridView').style.display = view === 'grid' ? 'grid' : 'none';
    document.getElementById('chartView').style.display = view === 'chart' ? 'block' : 'none';
    render();
  });
});

window.addEventListener('resize', () => { if (view === 'chart') renderChart(); });

render();
</script>
</body>
</html>